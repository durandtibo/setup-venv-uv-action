# Test Stable Action
#
# This reusable workflow tests the published stable version of the action.
# It ensures the released version continues to work correctly and detects regressions.
#
# Test Strategy:
#   - Uses the published stable version (durandtibo/setup-venv-uv-action@v0.0.3)
#   - Tests across multiple operating systems and architectures
#   - Validates Python environment setup and package imports
#
# Matrix Strategy:
#   - Ubuntu: Latest, 24.04, 22.04 (x64 and ARM)
#   - macOS: Latest, 26, 15, 14 (Intel and Apple Silicon)
#   - Total: 10 platform configurations
#
# Test Verification:
#   - Imports myproject package to verify installation
#   - Confirms Python environment is properly configured
#
# Purpose:
#   - Regression testing: Ensures published version still works
#   - Compatibility verification: Tests across multiple platforms
#   - User experience validation: Tests what users actually consume
#
# Permissions:
#   - actions: write - Required for workflow management
#   - contents: read - Required to checkout repository code

name: Test Stable Action

on:
  workflow_call:
  workflow_dispatch: # to trigger manually

permissions:
  actions: write
  contents: read

jobs:
  test:
    runs-on: ${{ matrix.os }}
    timeout-minutes: 2
    strategy:
      max-parallel: 8
      fail-fast: false
      matrix:
        os:
          [
            ubuntu-latest,
            ubuntu-24.04,
            ubuntu-22.04,
            ubuntu-24.04-arm,
            ubuntu-22.04-arm,
            macos-latest,
            macos-26,
            macos-15,
            macos-14,
            macos-15-intel,
          ]

    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Setup python environment
        uses: durandtibo/setup-venv-uv-action@v0.0.3

      - name: Test environment
        run: |
          python -c "import myproject; print(myproject)"

  test-package:
    runs-on: ubuntu-latest
    timeout-minutes: 2

    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Setup python environment
        uses: durandtibo/setup-venv-uv-action@v0.0.3
        with:
          package-name: numpy
          package-version: 2.4.0

      - name: Test environment
        run: |
          python -c "import myproject; print(myproject)"

  test-package-args:
    runs-on: ubuntu-latest
    timeout-minutes: 2

    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Setup python environment
        uses: durandtibo/setup-venv-uv-action@v0.0.3
        with:
          package-name: numpy
          package-version: 2.4.0
          package-install-args: "--upgrade"

      - name: Test environment
        run: |
          python -c "import myproject; print(myproject)"
